ì œê³µí•´ì£¼ì‹  ìœ íŠœë¸Œ ë°ì´í„° ì„¤ê³„ë¬¸ì„œì™€ ì•ì„œ ë…¼ì˜í•œ v9 ì•„í‚¤í…ì²˜ì˜ í•µì‹¬ ê¸°ìˆ (Parent-Child Retrieval, Agentic Workflow, Context Injection)ì„ ê²°í•©í•˜ì—¬, **[íˆ¬ì ì¸í…”ë¦¬ì „ìŠ¤ ì‹œìŠ¤í…œ: YouTube ë°ì´í„° ê³ ë„í™” ì„¤ê³„ì„œ v9.0]**ì„ ì‘ì„±í•©ë‹ˆë‹¤.

ê¸°ì¡´ ì„¤ê³„ì˜ 'ìˆ˜ì§‘ ì¤‘ì‹¬'ì—ì„œ **'ë¶„ì„ ë° ì‹ ë¢°ì„± ì¤‘ì‹¬'**ìœ¼ë¡œ íŒ¨ëŸ¬ë‹¤ì„ì„ ì „í™˜í•˜ì—¬, ì¦ê¶Œì‚¬ ë¦¬í¬íŠ¸ ë¶„ì„ ì‹œìŠ¤í…œê³¼ ë™ë“±í•œ ìˆ˜ì¤€ì˜ ì§€ëŠ¥ì„ ê°–ì¶”ë„ë¡ ì„¤ê³„í–ˆìŠµë‹ˆë‹¤.

---

# ğŸ“Š íˆ¬ì ì¸í…”ë¦¬ì „ìŠ¤ ì‹œìŠ¤í…œ: YouTube ë°ì´í„° ê³ ë„í™” ì„¤ê³„ì„œ (v9.0 Final)

> **ëª©í‘œ**: ìœ íŠœë¸Œ(ë™ì˜ìƒ) ë°ì´í„°ì˜ 'ë¹„ì •í˜•ì„±'ê³¼ 'ì‹ ë¢°ì„± ë‚œì œ'ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, **Context-Aware RAG**ì™€ **Self-Correcting Pipeline**ì„ ë„ì…. ë°œí™”ìì˜ ì»¨í…ìŠ¤íŠ¸(ì„±í–¥, ì „ë¬¸ì„±)ë¥¼ ì´í•´í•˜ê³ , ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ ì˜ê²¬ì˜ ì„ í–‰ì„±ì„ ê²€ì¦í•˜ëŠ” 'ì „ë¬¸ê°€ ì˜ê²¬ ì¶”ì  ì‹œìŠ¤í…œ' êµ¬ì¶•.

---

## 1. ì„¤ê³„ ê°œìš” ë° ì „ëµì  ëª©í‘œ

### 1.1 í•µì‹¬ ì„¤ê³„ ì›ì¹™ (v9 Upgrade)
1.  **Context over Text**: ë‹¨ìˆœ í…ìŠ¤íŠ¸(ìë§‰)ê°€ ì•„ë‹Œ, **ë°œí™”ìì˜ ì»¨í…ìŠ¤íŠ¸(Channel Profile, ê³¼ê±° ì ì¤‘ë¥ )**ë¥¼ ì„ë² ë”©ì— ì£¼ì…í•˜ì—¬ ê²€ìƒ‰ í’ˆì§ˆì„ ë†’ì…ë‹ˆë‹¤.
2.  **Parent-Child Retrieval**: ê²€ìƒ‰ì€ í•µì‹¬ ë°œí™”(Child)ë¡œ, ì¶”ë¡ ì€ ì „í›„ ë§¥ë½(Parent)ìœ¼ë¡œ ìˆ˜í–‰í•˜ì—¬ 'ë‹¨í¸ì  ì´í•´'ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.
3.  **Self-Correction Loop**: ìë™ ìƒì„± ìë§‰ì˜ ì˜¤íƒ€(ë…¸ì´ì¦ˆ)ë¥¼ LLMì´ ì‚¬ì „ êµì •í•˜ì—¬ ë°ì´í„° í’ˆì§ˆì„ í™•ë³´í•©ë‹ˆë‹¤.
4.  **Verifiable Citation**: ëª¨ë“  ì¸ì‚¬ì´íŠ¸ëŠ” íƒ€ì„ìŠ¤íƒ¬í”„ì™€ í•¨ê»˜ ì œê³µë˜ì–´, ì‚¬ìš©ìê°€ ì›ë³¸ ì˜ìƒì—ì„œ ì¦‰ì‹œ ê²€ì¦í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

### 1.2 ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (Architecture v9)

```mermaid
flowchart TD
    subgraph Source ["ë°ì´í„° ì†ŒìŠ¤"]
        A["YouTube Channels"]
    end

    subgraph Collection ["ìˆ˜ì§‘ ë ˆì´ì–´"]
        B["RSS Feed Monitor"]
        C["Hybrid Transcript Extractor\n(API + Local Whisper)"]
    end

    subgraph Processing ["ì²˜ë¦¬ ë ˆì´ì–´ (Self-Correction)"]
        D["LLM Corrector\n(Gemini Flash)"]
        E["Quality Evaluator"]
    end

    subgraph Intelligence ["ì§€ëŠ¥ ë ˆì´ì–´ (Context Injection)"]
        F["Speaker Context Injector"]
        G["Parent-Child Indexer"]
    end

    subgraph Storage ["ì €ì¥ì†Œ"]
        H[("PostgreSQL + pgvector")]
    end

    subgraph Agent ["ì„œë¹™ ë ˆì´ì–´ (Agent)"]
        I["Router Agent"]
        J["Deep Search\n(Vector + Keyword)"]
        K["Answer Generator\n(Claude 3.7)"]
    end

    A --> B --> C --> D --> E
    E -- "Passed" --> F --> G --> H
    
    I --> J --> H --> K
```

---

## 2. ë°ì´í„° ìˆ˜ì§‘ ë° ì •ì œ ì „ëµ (Collection & Refinement)

### 2.1 ìë§‰ ìˆ˜ì§‘: í•˜ì´ë¸Œë¦¬ë“œ 3ë‹¨ê³„ í´ë°±
ê¸°ì¡´ ì „ëµì„ ìœ ì§€í•˜ë˜, 2ì°¨(Whisper)ì˜ ìš°ì„ ìˆœìœ„ë¥¼ ìƒí–¥ ì¡°ì •í•˜ì—¬ í’ˆì§ˆì„ ë†’ì…ë‹ˆë‹¤.

| ìˆœìœ„ | ë°©ì‹ | ì‹œë‚˜ë¦¬ì˜¤ | íŠ¹ì§• |
|------|------|----------|------|
| **1ì°¨** | `youtube-transcript-api` | ìë™ ìƒì„± ìë§‰ í’ˆì§ˆ ì–‘í˜¸ ì‹œ | ë¹ ë¦„ (1ì´ˆ), ë¹„ìš© ì—†ìŒ. |
| **2ì°¨** | **Local Whisper (Large-v3)** | ìë§‰ ì—†ìŒ or í’ˆì§ˆ ë¶ˆëŸ‰ ì‹œ | **ê³ í’ˆì§ˆ**, M5 Mac í™œìš©. |
| **3ì°¨** | Gemini 2.0 Flash (Audio) | ì˜¤ë””ì˜¤ í’ˆì§ˆ ë§¤ìš° ë¶ˆëŸ‰ ì‹œ | ë©€í‹°ëª¨ë‹¬ ì§ì ‘ ì²­ì·¨. |

### 2.2 ìë§‰ í’ˆì§ˆ ê´€ë¦¬ ë° LLM êµì • (New!)
ìœ íŠœë¸Œ ìë§‰ì˜ ê°€ì¥ í° ë¬¸ì œì¸ 'ì˜¤íƒ€'ì™€ 'ë‹¨ì–´ ì˜¤ì¸ì‹'ì„ í•´ê²°í•©ë‹ˆë‹¤.

**Process**:
1.  **1ì°¨ í•„í„°ë§ (Rule-based)**: í…ìŠ¤íŠ¸ ê¸¸ì´, íŠ¹ìˆ˜ë¬¸ì ë¹„ìœ¨ ë“±ìœ¼ë¡œ ëª…ë°±í•œ ë¶ˆëŸ‰ ë°ì´í„° ì œê±°.
2.  **2ì°¨ êµì • (LLM-based)**: í†µê³¼ëœ í…ìŠ¤íŠ¸ë¼ë„ ê¸ˆìœµ ìš©ì–´(HBM -> ì—ì¹˜ë¹„ì— ) ì˜¤ë¥˜ê°€ ë§ìœ¼ë¯€ë¡œ **Gemini Flash**ë¥¼ í†µí•´ 1ì°¨ êµì •.

```python
# LLM Correction Prompt ì˜ˆì‹œ
prompt = """
ë„ˆëŠ” ê¸ˆìœµ ì „ë¬¸ê°€ë‹¤. ì•„ë˜ ìœ íŠœë¸Œ ìë§‰ í…ìŠ¤íŠ¸ì—ëŠ” ìŒì„± ì¸ì‹ ì˜¤ë¥˜ê°€ ë§ë‹¤.
ë¬¸ë§¥ì„ ê³ ë ¤í•˜ì—¬ ê¸ˆìœµ ìš©ì–´, ê¸°ì—…ëª…, ì „ë¬¸ ìš©ì–´ë¥¼ ì˜¬ë°”ë¥´ê²Œ êµì •í•˜ë¼.
ë‹¨, ì›ë¬¸ì˜ ë¬¸ì²´ì™€ ì˜ë¯¸ëŠ” í›¼ì†í•˜ì§€ ë§ˆë¼.

[ì›ë¬¸]:
"ì—ì¹˜ë¹„ì—  ìˆ˜ì£¼ê°€ ëŠ˜ì–´ë‚˜ë©´ì„œ ì‚¼ì„±ì „ìì˜ ì‹¤ì ì´ ê°œì„ ë  ê¸°ë¯¸ê°€ ë³´ì¸ë‹¤."

[êµì •ë¬¸]:
"HBM ìˆ˜ì£¼ê°€ ëŠ˜ì–´ë‚˜ë©´ì„œ ì‚¼ì„±ì „ìì˜ ì‹¤ì ì´ ê°œì„ ë  ê¸°ë¯¸ê°€ ë³´ì¸ë‹¤."
"""
```

---

## 3. LLM ë¶„ì„ ë° ì»¨í…ìŠ¤íŠ¸ ì£¼ì… ì „ëµ

### 3.1 ë™ì  ì»¨í…ìŠ¤íŠ¸ ì£¼ì… (Dynamic Context Injection)
ê²€ìƒ‰ ì •í™•ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´, ìë§‰ ì²­í¬(Child)ì— **ë©”íƒ€ë°ì´í„° Prefix**ë¥¼ ì£¼ì…í•©ë‹ˆë‹¤.

*   **Prefix êµ¬ì¡°**: `[ë°œí™”ì: OOO | ì±„ë„ì„±í–¥: ìŠ¤ìœ™íŠ¸ë ˆì´ë”© | ì „ë¬¸ì„±: ë°˜ë„ì²´] + [ìë§‰ ë‚´ìš©]`
*   **íš¨ê³¼**: ë™ì¼í•œ "ì§€ê¸ˆ ì‚¬ë„ ëœë‹¤"ëŠ” ë°œì–¸ì´ë¼ë„, 'ìŠ¤ìœ™ íŠ¸ë ˆì´ë”'ì˜ ë°œì–¸ê³¼ 'í€ë”ë©˜í„¸ ì• ë„ë¦¬ìŠ¤íŠ¸'ì˜ ë°œì–¸ì„ ë²¡í„° ê³µê°„ì—ì„œ ë¶„ë¦¬í•˜ì—¬ ê²€ìƒ‰ ì •í™•ë„ í–¥ìƒ.

### 3.2 í”„ë¡¬í”„íŠ¸ ë¼ìš°íŒ… ë° ë¶„ì„ (Analysis Strategy)

ì˜ìƒ ìœ í˜•ì— ë”°ë¼ ë¶„ì„ í”„ë¡¬í”„íŠ¸ë¥¼ ë‹¤ë¥´ê²Œ ì ìš©í•©ë‹ˆë‹¤.

1.  **Classification**: ì˜ìƒ ìœ í˜• íŒë³„ (Single POV, Debate, Macro).
2.  **Extraction**:
    *   **Opinion Extraction**: ì£¼ì¥, ê·¼ê±°, ê´€ë ¨ ì¢…ëª© ì¶”ì¶œ.
    *   **Sentiment Calibration**: ë‹¨ìˆœ ê¸ì •/ë¶€ì •ì´ ì•„ë‹Œ, **í™•ì‹ ë„(Confidence Score)** ë¶€ì—¬.

---

## 4. ì„ë² ë”© ë° ê²€ìƒ‰ ì „ëµ (Parent-Child Retrieval)

### 4.1 ì²­í‚¹ ì „ëµ (2-Level Architecture)
**"ê²€ìƒ‰ì€ ì‘ê²Œ, ë§¥ë½ì€ í¬ê²Œ"** ì›ì¹™ì„ ì ìš©í•©ë‹ˆë‹¤.

1.  **Parent (Context)**: 2~3ë¶„ ë‹¨ìœ„ì˜ ë°œí™” ë©ì–´ë¦¬ (ì „í›„ ë§¥ë½ íŒŒì•…ìš©).
2.  **Child (Index)**: Parent ë‚´ì—ì„œ í•µì‹¬ ì£¼ì¥ì´ ë‹´ê¸´ ë¬¸ì¥ ë‹¨ìœ„ (ë²¡í„° ê²€ìƒ‰ìš©).

### 4.2 ê²€ìƒ‰ í”„ë¡œì„¸ìŠ¤ (Hybrid Search)

```sql
-- í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ì¿¼ë¦¬ ì˜ˆì‹œ
SELECT 
    p.content as parent_context,  -- ì „í›„ ë§¥ë½
    c.content as child_hit,       -- ê²€ìƒ‰ëœ í•µì‹¬ ë¬¸ì¥
    c.start_time,                 -- íƒ€ì„ìŠ¤íƒ¬í”„
    v.title, v.url
FROM transcript_chunks c
JOIN transcript_segments p ON c.parent_id = p.id
JOIN videos v ON c.video_id = v.video_id
WHERE 
    c.content LIKE '%ì‚¼ì„±ì „ì%' -- í‚¤ì›Œë“œ í•„í„°ë§
ORDER BY c.embedding <=> :query_vector -- ë²¡í„° ìœ ì‚¬ë„
LIMIT 5;
```

---
**[ì œ1ë¶€] ì™„ë£Œ.**
ë‹¤ìŒ ì„¹ì…˜ì¸ **[ì œ2ë¶€: ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ (Schema v9) ë° êµ¬í˜„ ê°€ì´ë“œ]**ë¥¼ ì´ì–´ì„œ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤. `continue`ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.

---

## 5. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ (Database Schema v9)

v9 ì•„í‚¤í…ì²˜ì˜ í•µì‹¬ì¸ **Parent-Child êµ¬ì¡°**ì™€ **ì‹ ë¢°ì„± ê²€ì¦(Verifiable Citation)**, ê·¸ë¦¬ê³  **í™”ì ì»¨í…ìŠ¤íŠ¸(Speaker Context)**ë¥¼ ì™„ë²½í•˜ê²Œ ì§€ì›í•˜ëŠ” ìŠ¤í‚¤ë§ˆì…ë‹ˆë‹¤.

### 5.1 ERD (Entity Relationship Diagram)

```mermaid
erDiagram
    CHANNELS ||--o{ VIDEOS : "uploads"
    VIDEOS ||--o{ TRANSCRIPTS : "has"
    TRANSCRIPTS ||--o{ TRANSCRIPT_SEGMENTS : "has_parent"
    TRANSCRIPT_SEGMENTS ||--o{ TRANSCRIPT_CHUNKS : "contains_child"
    
    VIDEOS ||--|| VIDEO_ANALYSES : "analyzed_by"
    VIDEO_ANALYSES ||--o{ SPEAKER_OPINIONS : "extracts"
    
    CHANNELS {
        uuid id PK
        string channel_name
        string channel_category
        float credibility_score "ì‹ ë¢°ë„ ì ìˆ˜ (0~100)"
        jsonb speaker_profile "ì„±í–¥, ì „ë¬¸ ë¶„ì•¼"
    }

    TRANSCRIPTS {
        uuid id PK
        string video_id FK
        text full_text "ì›ë¬¸"
        text corrected_text "LLM êµì •ë³¸"
        string source_type
    }

    TRANSCRIPT_SEGMENTS {
        uuid id PK
        uuid transcript_id FK
        text content "Parent Context (2~3ë¶„ ë‹¨ìœ„)"
        float start_time
        float end_time
    }

    TRANSCRIPT_CHUNKS {
        uuid id PK
        uuid segment_id FK "Parent ì°¸ì¡°"
        vector embedding
        text content "Child (í•µì‹¬ ë°œí™”)"
        float start_time
    }

    SPEAKER_OPINIONS {
        uuid id PK
        string video_id FK
        string asset_code
        string speaker_name
        float sentiment_score
        float confidence_score "í™•ì‹ ë„"
        jsonb supporting_quotes
        float evidence_start_time
    }
```

### 5.2 SQL DDL (PostgreSQL)

Parent-Child ê´€ê³„ì™€ ì»¨í…ìŠ¤íŠ¸ ê²€ìƒ‰ì„ ìœ„í•œ êµ¬ì¡°í™”ëœ ìŠ¤í‚¤ë§ˆì…ë‹ˆë‹¤.

```sql
-- ==========================================
-- 0. í™•ì¥ ê¸°ëŠ¥ í™œì„±í™”
-- ==========================================
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "pgvector";
CREATE EXTENSION IF NOT EXISTS "pg_trgm";

-- ==========================================
-- 1. ì±„ë„ ì •ë³´ (í™”ì ì»¨í…ìŠ¤íŠ¸)
-- ==========================================
CREATE TABLE channels (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    youtube_channel_id VARCHAR(100) UNIQUE NOT NULL,
    channel_name VARCHAR(200) NOT NULL,
    
    -- v9: ì‹ ë¢°ë„ ê´€ë¦¬
    credibility_score FLOAT DEFAULT 50.0, -- 0~100 (ê³¼ê±° ì ì¤‘ë¥  ê¸°ë°˜)
    channel_category VARCHAR(50),        -- 'technical', 'macro', 'entertainment'
    
    -- v9: ë™ì  í”„ë¡œí•„ (LLMì´ ì—…ë°ì´íŠ¸)
    speaker_profile JSONB DEFAULT '{}', -- {"style": "ìŠ¤ìœ™íŠ¸ë ˆì´ë”©", "expertise": ["ë°˜ë„ì²´", "2ì°¨ì „ì§€"]}
    
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW()
);

-- ==========================================
-- 2. ì˜ìƒ ë©”íƒ€ë°ì´í„°
-- ==========================================
CREATE TABLE videos (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    video_id VARCHAR(20) UNIQUE NOT NULL,
    channel_id UUID REFERENCES channels(id),
    
    title TEXT NOT NULL,
    published_at TIMESTAMP NOT NULL,
    duration_seconds INTEGER,
    
    -- ì²˜ë¦¬ ìƒíƒœ
    status VARCHAR(20) DEFAULT 'new', -- 'new', 'corrected', 'analyzed'
    video_type VARCHAR(30),           -- 'single_pov', 'debate'
    
    created_at TIMESTAMP DEFAULT NOW()
);

-- ==========================================
-- 3. ìë§‰ ì›ë¬¸ ë° êµì • (Source of Truth)
-- ==========================================
CREATE TABLE transcripts (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    video_id VARCHAR(20) REFERENCES videos(video_id),
    
    -- ì›ë¬¸ ë³´ì¡´
    source_type VARCHAR(30) NOT NULL, -- 'youtube_api', 'whisper'
    full_text TEXT NOT NULL,
    
    -- v9: LLM êµì • í…ìŠ¤íŠ¸
    corrected_text TEXT, 
    
    is_primary BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW()
);

-- ==========================================
-- 4. ìë§‰ ì„¸ê·¸ë¨¼íŠ¸ (Parent Document)
-- ==========================================
CREATE TABLE transcript_segments (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    transcript_id UUID REFERENCES transcripts(id) ON DELETE CASCADE,
    video_id VARCHAR(20) NOT NULL,
    
    -- Parent Context (2~3ë¶„ ë‹¨ìœ„)
    content TEXT NOT NULL, 
    
    start_time FLOAT NOT NULL,
    end_time FLOAT NOT NULL,
    
    created_at TIMESTAMP DEFAULT NOW()
);

-- ==========================================
-- 5. ìë§‰ ì²­í¬ (Child Document & Vector)
-- ==========================================
CREATE TABLE transcript_chunks (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    
    -- Parent ì°¸ì¡° (ë§¥ë½ í™•ë³´ìš©)
    segment_id UUID REFERENCES transcript_segments(id) ON DELETE CASCADE,
    video_id VARCHAR(20) NOT NULL,
    
    -- Child Content (ê²€ìƒ‰ìš©)
    content TEXT NOT NULL, -- í•µì‹¬ ë°œí™” ë¬¸ì¥
    start_time FLOAT,      -- ì •í™•í•œ íƒ€ì„ìŠ¤íƒ¬í”„
    
    -- Vector (BGE-M3: 1024ì°¨ì›)
    embedding vector(1024),
    
    created_at TIMESTAMP DEFAULT NOW()
);

-- Vector Index
CREATE INDEX idx_chunks_embedding ON transcript_chunks 
    USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100);

-- ==========================================
-- 6. ì „ë¬¸ê°€ ì˜ê²¬ ì¶”ì¶œ (Opinion)
-- ==========================================
CREATE TABLE speaker_opinions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    video_id VARCHAR(20) REFERENCES videos(video_id),
    analysis_id UUID REFERENCES video_analyses(id),
    
    -- ìì‚° ì‹ë³„
    asset_code VARCHAR(50),
    asset_name VARCHAR(200),
    
    -- ì˜ê²¬ ë‚´ìš©
    speaker_name VARCHAR(100),
    sentiment_score FLOAT,       -- -1.0 ~ 1.0
    confidence_score FLOAT,      -- 0.0 ~ 1.0 (í™”ìì˜ í™•ì‹ ë„)
    opinion_summary TEXT,
    
    -- ê·¼ê±° (Verifiable Citation)
    supporting_quotes JSONB,     -- ["ì¸ìš© ë¬¸êµ¬ 1", "ì¸ìš© ë¬¸êµ¬ 2"]
    evidence_start_time FLOAT,   -- ì˜ìƒ ë‚´ ì¦ê±° ìœ„ì¹˜
    
    -- ì‹œê³„ì—´
    published_at TIMESTAMP NOT NULL,
    
    created_at TIMESTAMP DEFAULT NOW()
);

-- ê²€ìƒ‰ìš© ì¸ë±ìŠ¤
CREATE INDEX idx_opinions_asset_time ON speaker_opinions(asset_code, published_at DESC);
```

---

## 6. ìƒì„¸ êµ¬í˜„ ê°€ì´ë“œ (Implementation Guide)

### 6.1 ìë§‰ êµì • ë° ì •ì œ (Correction Logic)

ë‹¨ìˆœ OCR ì˜¤ë¥˜ë¥¼ ë„˜ì–´, ê¸ˆìœµ ë„ë©”ì¸ ìš©ì–´ë¥¼ ì •í™•íˆ êµì •í•˜ëŠ” ë¡œì§ì…ë‹ˆë‹¤.

```python
async def correct_transcript(raw_text: str, video_id: str) -> str:
    """
    Gemini Flashë¥¼ ì‚¬ìš©í•˜ì—¬ ìë§‰ í’ˆì§ˆ ê³ ë„í™”
    """
    prompt = f"""
    ë„ˆëŠ” ê¸ˆìœµ ì „ë¬¸ê°€ë‹¤. ì•„ë˜ ìœ íŠœë¸Œ ìë§‰ í…ìŠ¤íŠ¸ì—ëŠ” ìŒì„± ì¸ì‹ ì˜¤ë¥˜ê°€ ë§ë‹¤.
    ë¬¸ë§¥ì„ ê³ ë ¤í•˜ì—¬ ê¸ˆìœµ ìš©ì–´, ê¸°ì—…ëª…, ì „ë¬¸ ìš©ì–´ë¥¼ ì˜¬ë°”ë¥´ê²Œ êµì •í•˜ë¼.
    ì›ë¬¸ì˜ ì¤„ë°”ê¿ˆê³¼ ë¬¸ì²´ëŠ” ìœ ì§€í•˜ë˜, ê°€ë…ì„±ì„ ìœ„í•´ ë¬¸ë‹¨ êµ¬ë¶„ì„ ì¶”ì²œí•œë‹¤.

    [ì›ë¬¸]:
    {raw_text}

    [êµì •ë¬¸]:
    """
    
    response = await gemini_client.generate_content_async(prompt)
    corrected_text = response.text
    
    # DB ì—…ë°ì´íŠ¸
    await db.execute(
        "UPDATE transcripts SET corrected_text = $1 WHERE video_id = $2",
        corrected_text, video_id
    )
    return corrected_text
```

### 6.2 Parent-Child ì²­í‚¹ ë° ì„ë² ë”© (Chunking Logic)

"ê²€ìƒ‰ì€ ì‘ê²Œ, ë§¥ë½ì€ í¬ê²Œ" ì „ëµì„ êµ¬í˜„í•©ë‹ˆë‹¤.

```python
async def create_parent_child_chunks(video_id: str, transcript: dict):
    segments = transcript['segments'] # ìë§‰ íƒ€ì„ë¼ì¸ ë°ì´í„°
    
    # 1. Parent Segment ìƒì„± (2~3ë¶„ ë‹¨ìœ„ ë³‘í•©)
    parent_segments = []
    current_buffer = []
    time_cursor = 0
    
    for seg in segments:
        current_buffer.append(seg['text'])
        
        # 180ì´ˆ(3ë¶„) ë‹¨ìœ„ë¡œ ë³‘í•©
        if seg['start'] - time_cursor > 180:
            parent_text = " ".join(current_buffer)
            parent_id = await save_parent_segment(video_id, parent_text, time_cursor, seg['start'])
            parent_segments.append((parent_id, parent_text))
            
            # ì´ˆê¸°í™”
            current_buffer = []
            time_cursor = seg['start']
            
    # 2. Child Chunk ìƒì„± ë° ì„ë² ë”© (ë¬¸ì¥ ë‹¨ìœ„ ë¶„ë¦¬)
    for parent_id, parent_text in parent_segments:
        sentences = split_sentences(parent_text) # ë§ˆì¹¨í‘œ ê¸°ì¤€ ë¶„ë¦¬
        
        for sent in sentences:
            # í•µì‹¬ ë‚´ìš©ì´ ë‹´ê¸´ ë¬¸ì¥ë§Œ Childë¡œ ì„ ë³„ (ì„ íƒì )
            if is_meaningful(sent): 
                # v9: ì»¨í…ìŠ¤íŠ¸ ì£¼ì… (ë°œí™”ì ì •ë³´ ë“±)
                context_prefix = await get_speaker_prefix(video_id)
                embedding_text = f"{context_prefix}\n---\n{sent}"
                
                # ì„ë² ë”© ìƒì„± (Local BGE-M3)
                vector = generate_embedding(embedding_text)
                
                await db.execute("""
                    INSERT INTO transcript_chunks 
                    (segment_id, video_id, content, embedding, start_time)
                    VALUES ($1, $2, $3, $4, $5)
                """, parent_id, video_id, sent, vector, estimate_time(sent))
```

### 6.3 ì‹ ë¢°ë„ ê¸°ë°˜ ê²€ìƒ‰ (Hybrid Search)

ê²€ìƒ‰ ì‹œ ì±„ë„ì˜ ì‹ ë¢°ë„ ì ìˆ˜ë¥¼ ë°˜ì˜í•˜ì—¬ ê²°ê³¼ì˜ í’ˆì§ˆì„ ë³´ì •í•©ë‹ˆë‹¤.

```python
async def search_youtube_insights(query: str, asset_code: str):
    query_vector = generate_embedding(query)
    
    # SQL: ë²¡í„° ê²€ìƒ‰ + í‚¤ì›Œë“œ í•„í„° + ì‹ ë¢°ë„ ì¡°ì¸
    results = await db.fetch("""
        SELECT 
            c.content as child_hit,
            ps.content as parent_context,
            v.title,
            v.video_id,
            ch.channel_name,
            ch.credibility_score,
            c.start_time
        FROM transcript_chunks c
        JOIN transcript_segments ps ON c.segment_id = ps.id
        JOIN videos v ON c.video_id = v.video_id
        JOIN channels ch ON v.channel_id = ch.id
        WHERE 
            c.content LIKE :asset_keyword
        ORDER BY 
            -- ìœ ì‚¬ë„(0~1)ì™€ ì‹ ë¢°ë„(0~1)ë¥¼ ê°€ì¤‘í•©
            (1 - (c.embedding <=> :query_vec)) * 0.7 + (ch.credibility_score / 100) * 0.3 DESC
        LIMIT 10
    """, query_vector=query_vector, asset_keyword=f"%{asset_code}%")
    
    return results
```

---

## 7. ìš´ì˜ ë° í”¼ë“œë°± ë£¨í”„ (Operations)

### 7.1 ì‹ ë¢°ë„ ì ìˆ˜ ê°±ì‹  (Credibility Update)

ìœ íŠœë²„ì˜ ì˜ê²¬ì´ ì‹¤ì œ ì‹œì¥ê³¼ ë¶€í•©í–ˆëŠ”ì§€ ì¶”ì í•˜ì—¬ ì‹ ë¢°ë„ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

*   **ì£¼ê¸°**: ì›” 1íšŒ.
*   **ë¡œì§**: 3ê°œì›” ì „ 'ê°•ë ¥ ë§¤ìˆ˜' ì˜ê²¬ì„ ëƒˆë˜ ì¢…ëª©ì˜ ìˆ˜ìµë¥  í™•ì¸.
    *   ìˆ˜ìµë¥  > 10% -> ì‹ ë¢°ë„ +5ì .
    *   ìˆ˜ìµë¥  < -5% -> ì‹ ë¢°ë„ -5ì .

### 7.2 ë°°ì¹˜ ìŠ¤ì¼€ì¤„ (Daily)
*   **06:00**: RSS í”¼ë“œ ìˆ˜ì§‘ ë° ì˜ìƒ ë©”íƒ€ë°ì´í„° ì €ì¥.
*   **06:30**: ìë§‰ ì¶”ì¶œ (API -> Whisper í´ë°±).
*   **07:00**: **LLM ìë§‰ êµì • (Correction)**.
*   **07:30**: Parent-Child ì²­í‚¹ ë° ì„ë² ë”©.
*   **08:00**: ì˜ê²¬(Opinion) ì¶”ì¶œ ë° ì‹œê³„ì—´ DB ì—…ë°ì´íŠ¸.

---

## 8. ê²°ë¡  (Conclusion)

ë³¸ v9.0 ì„¤ê³„ëŠ” ìœ íŠœë¸Œ ë°ì´í„°ì˜ 'ì‹ ë¢°ì„±'ê³¼ 'ë§¥ë½' ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.

1.  **Self-Correction**: LLMì„ í†µí•œ ìë§‰ êµì •ìœ¼ë¡œ ë°ì´í„° í’ˆì§ˆì„ ì›ì²œì ìœ¼ë¡œ í–¥ìƒì‹œì¼°ìŠµë‹ˆë‹¤.
2.  **Parent-Child Architecture**: í•µì‹¬ ë°œí™”(Child)ë¡œ ê²€ìƒ‰í•˜ê³  ì „í›„ ë§¥ë½(Parent)ìœ¼ë¡œ ì´í•´í•¨ìœ¼ë¡œì¨ ì˜¤í•´ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.
3.  **Verifiable System**: ëª¨ë“  ì¸ì‚¬ì´íŠ¸ì— íƒ€ì„ìŠ¤íƒ¬í”„ì™€ í™”ì ì •ë³´ë¥¼ ë¶€ì—¬í•˜ì—¬, ì‚¬ìš©ìê°€ ìŠ¤ìŠ¤ë¡œ íŒë‹¨í•  ìˆ˜ ìˆëŠ” ê·¼ê±°ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
4.  **Credibility Management**: ì±„ë„ë³„ ì‹ ë¢°ë„ ì ìˆ˜ë¥¼ ê´€ë¦¬í•˜ì—¬, ê³¼ì¥ëœ ì •ë³´ëŠ” ê±¸ëŸ¬ë‚´ê³  ê²€ì¦ëœ ì „ë¬¸ê°€ì˜ ëª©ì†Œë¦¬ì— ì§‘ì¤‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ì‹œìŠ¤í…œì€ í…ìŠ¤íŠ¸ ë©ì–´ë¦¬ì— ë¶ˆê³¼í–ˆë˜ ìœ íŠœë¸Œ ìë§‰ì„, **'ì‹œê³µê°„ì´ ëª…í™•í•œ íˆ¬ì ì˜ê²¬ ë°ì´í„°'**ë¡œ ë³€í™˜í•˜ëŠ” ê°•ë ¥í•œ ì—”ì§„ì…ë‹ˆë‹¤.

---
**[ìµœì¢… ë¬¸ì„œ ì™„ë£Œ]**